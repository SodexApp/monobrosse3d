<!DOCTYPE html>
<html>
	<head>

<!-- 		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"> -->
		<link type="text/css" rel="stylesheet" href="myStyle.css">
<script src="https://cdn.jsdelivr.net/npm/three@0.115.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.115.0/examples/js/renderers/CSS3DRenderer.js"></script>
	</head>
	
  <body>
    <div>
      <canvas id = "myCanvas"></canvas>
<button id= "animate" hidden>animer</button>
<button id="stopBtn" hidden>Stop Animation</button>
<button id = "sol" hidden>sol</button>
<button id = "disc" hidden>disque</button>
    </div>
         <div >     
        <button id="start-recording" >play 
           <span id="recording-indicator" style = "display:none"></span> 
        </button>
        <button id="stop-recording" >pause</button>
       
      </div> 
      <script src = "createScene.js"></script>

<!--     // add script basicscene////////////////////////////// -->
    <script>
      
     var image = "https://cdn.glitch.global/5bd793e6-3c08-44e5-bec2-8b45b68b56c7/disque_s3m.jpg?v=1675426903770";
     var url = "https://cdn.glitch.global/5bd793e6-3c08-44e5-bec2-8b45b68b56c7/avatar.mp4?v=1677849753537";//video materiel
     var script = document.createElement("script");
    script.src ="basicScene.js?url=" + encodeURIComponent(url)+"&image=" + encodeURIComponent(image);
    document.body.appendChild(script);
    </script> 
    
<!--       <script src = "basicScene.js?url=https://cdn.glitch.global/5bd793e6-3c08-44e5-bec2-8b45b68b56c7/avatar.mp4?v=1677849753537"></script> -->
      <script src = "webcamStore.js"></script>
      <script>
       // scene.remove(scene.getObjectByName("videoPlane"));
      
      function animate () {
    requestAnimationFrame( animate );

   //controls.update();
  
    renderer.render( scene, camera );
};
animate();
// // Assume "scene" is the Three.js scene
// for (let i = 0; i < scene.children.length; i++) {
//   // Do something with the child object
//   console.log(scene.children[i].name);
// } 
        
        
//         maniement de la webcam appui alternatif sur WebcamMonitor
      
      
            // add raycaster
var raycaster = new THREE.Raycaster(); // Create a new Raycaster
 if(isMobile())  {
   
   console.log("ismobile"+isMobile());
   console.log(navigator.userAgent);
window.addEventListener('touchstart', onTouchStart, false);
// window.addEventListener('touchmove', onTouchMove, false);
   
 } else{
    
window.addEventListener('mousemove', onMouseMove, false); // Add a mousemove event listener to the window object
window.addEventListener('click', onClick, false); // Add a click event listener to the window object
 } 
    
function isMobile(){
// Check the user agent string to see if it contains "Mobile"
  return /Mobi/i.test(navigator.userAgent);  
}
    
var mouse = new THREE.Vector2(); // Create a new Vector2 to store the mouse coordinates

function onMouseMove(event) {
  // Calculate the mouse position relative to the viewport
    
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
}
    
    
 let isAnimating = false;//webcam
        let isPlaying = true;//video
function onClick(event) {
  // Use the Raycaster to check for intersections between the mouse and the objects in the scene
  raycaster.setFromCamera(mouse, camera);
  var intersects = raycaster.intersectObjects(scene.children, true);

  // If there is at least one intersection, trigger your function
  if (intersects.length > 0) {
    
    var object = intersects[0].object;
    
    if(object.name === "webcamMonitor"){
      
      if(!isAnimating){
      console.log(object);
     startRecording();
       isAnimating = true;  
      }
    
     else {
    stopRecording();
    isAnimating = false;
    }
    }
    if(object.name === "videoPlane"){
      if(isPlaying){
      clip.pause();
        isPlaying = false;
    }
      else{
        clip.play();
        isPlaying = true;
      }
  }      
 }
}

    
    function onTouchStart(event){
      event.preventDefault();

  const touch = event.touches[ 0 ];
  const x = ( touch.clientX / window.innerWidth ) * 2 - 1;
  const y = - ( touch.clientY / window.innerHeight ) * 2 + 1;

  raycaster.setFromCamera( new THREE.Vector2( x, y ), camera );
       var intersects = raycaster.intersectObjects(scene.children, true);
       if (intersects.length > 0) {
    
    var object = intersects[0].object;
    
    if(object.name === "webcamMonitor"){
      
      if(!isAnimating){
      console.log(object);
     startRecording();
       isAnimating = true;  
      }
    
     else {
    stopRecording();
    isAnimating = false;
    }
    }
             if(object.name === "videoPlane"){
      if(isPlaying){
      clip.pause();
        isPlaying = false;
    }
      else{
        clip.play();
        isPlaying = true;
      }
  }
  }      
 }


      
        
      </script>
  </body>
</html>