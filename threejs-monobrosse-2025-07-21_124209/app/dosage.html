<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!--     <link rel="stylesheet" href="myStyle.css"> -->
    <style>
      .btn-group button {
        background-color: #04aa6d; /* Green background */
        border: 1px solid green; /* Green border */
        color: white; /* White text */
        //padding: 20px 10px; /* Some padding */
        cursor: pointer; /* Pointer/hand icon */
        float: left; /* Float the buttons side by side */
      }

      .btn-group button:not(:last-child) {
        border-right: none; /* Prevent double borders */
      }

      /* Clear floats (clearfix hack) */
      .btn-group:after {
        content: "";
        clear: both;
        display: table;
      }

      /* Add a background color on hover */
      .btn-group button:hover {
        background-color: #3e8e41;
      }
      canvas {
        width:300px;
        height:300px;
        border: 1px solid;
        background-color: white;
      }
      #contenance{
        
        height:15px;
        text-align:right;
        font-size:15px;
      }   
    </style>
  </head>
  <body onload="startGame()">
  
    <div style="display: none">
      <img
        id="doseur"
        src="https://cdn.glitch.global/4cef7129-e8a3-4961-b041-cb72b1ca9cd9/verre-doseur-250-ml.jpg?v=1665402126921"
      />
      <img
        id="gobelet"
        src="https://cdn.glitch.global/4cef7129-e8a3-4961-b041-cb72b1ca9cd9/gobelet.jfif?v=1665587888010"
      />
    </div>
    <script>
      var myGamePiece;
      var myScore;
      var myDoseurLevel;

      function startGame() {
        myScore = new component("40px", "Consolas", "black", 70, 50, "text");
        myCl = new component("40px", "Consolas", "black", 350, 50, "text");
        myGamePiece = new component(190, 1, "blue", 40, 470);
        myDoseurLevel = new component(50, 1, "red", 311, 200);
        myBordDroit = new component(10, 370, "grey", 30, 100);
        myBordGauche = new component(10, 370, "grey", 230, 100);
        myFond = new component(210, 10, "grey", 30, 470);
        //myGbLevel = new component(10,2,"orange",500,500);
        doseurLevel2 = new component(50, 1, "red", 417, 200);
        doseurLevel3 = new component(50, 1, "red", 517, 200);
        doseurLevel4 = new component(50, 1, "red", 617, 200);

        myGameArea.start();
      }

      var myGameArea = {
        canvas: document.createElement("canvas"),

        start: function () {
          this.canvas.width = 480;
          this.canvas.height = 480;
          this.context = this.canvas.getContext("2d");
          document.body.insertBefore(this.canvas, document.body.childNodes[0]);
          this.frameNo = 0;
          this.interval = setInterval(updateGameArea, 0);
        },

        clear: function () {
          this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        },
        drawImage: function () {
          this.context.globalAlpha = 0.5;
          this.context.drawImage(
            document.getElementById("doseur"),
            275,
            50,
            130,
            160
          );
        },
        drawGobelet: function (x, y) {
          this.context.globalAlpha = 0.5;
          this.context.drawImage(
            document.getElementById("gobelet"),
            x,
            y,
            30,
            30
          );
        },
        drawDoseur: function (x, y) {
          this.context.globalAlpha = 0.5;
          this.context.drawImage(
            document.getElementById("doseur"),
            x,
            y,
            130,
            160
          );
        },
      };
      function component(width, height, color, x, y, type) {
        this.type = type;
        this.width = width;
        this.height = height;
        this.speedX = 0;
        this.speedY = 0;
        this.x = x;
        this.y = y;
        this.update = function () {
          ctx = myGameArea.context;
          if (this.type == "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
          } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
          }
        };
        this.newPos = function () {
          this.height += this.speedY;
        };
      }

      function updateGameArea() {
        myGameArea.clear();
        //myGameArea.frameNo += 1;
        var dosage = -(myGamePiece.height / 300) * 100;
        var content = document.getElementById("contenance").value;
        myScore.text = dosage.toFixed(0) + "%";
        var solution = content * dosage.toFixed(0);
        var step = (solution / 20).toFixed(0);
        myCl.text = solution + "cl";
        myScore.update();
        myCl.update();
        myGamePiece.newPos();
        myGamePiece.update();
        myBordDroit.update();
        myBordGauche.update();
        myFond.update();
        myGameArea.drawImage();

        for (i = 0; i < step; i++) {
          //affichage des gobelets en ligne et colonne
          var row = Math.floor(i / 10);
          var col = i % 10;
          var x = 250 + col * 35;
          var y = 300 + row * 35;
          myGameArea.drawGobelet(x, y);
        }
        new component(// fixation du trait jaune 
          12,
          -(20 - (solution % 20)),
          "orange",
          x + 8,
          y + 30
        ).update();
        

        if (solution < 251) {
          // depassement capacité du doseur dessin 2eme doseur
          myDoseurLevel.newPos();
          myDoseurLevel.update();
        } else if (solution < 501) {
          myGameArea.drawDoseur(380, 50);
          doseurLevel2.newPos();
          doseurLevel2.update();
        } else if (solution < 751) {
          myGameArea.drawDoseur(380, 50);
          myGameArea.drawDoseur(480, 50);
          doseurLevel3.newPos();
          doseurLevel3.update();
        } else {
          myGameArea.drawDoseur(380, 50);
          myGameArea.drawDoseur(480, 50);
          myGameArea.drawDoseur(580, 50);
          doseurLevel4.newPos();
          doseurLevel4.update();
        }
      }

      function moveup() {
        myGamePiece.speedY -= 0.05;
        var content = document.getElementById("contenance").value;
        myDoseurLevel.speedY -= 0.008 * content;
        doseurLevel2.speedY -= 0.008 * content;
        doseurLevel3.speedY -= 0.008 * content;
        doseurLevel4.speedY -= 0.008 * content;
      }

      function movedown() {
        var content = document.getElementById("contenance").value;
        myGamePiece.speedY += 0.05;
        myDoseurLevel.speedY += 0.008 * content;
        doseurLevel2.speedY += 0.008 * content;
        doseurLevel3.speedY += 0.008 * content;
        doseurLevel4.speedY += 0.008 * content;
      }
      function stopMove() {
        myGamePiece.speedX = 0;
        myGamePiece.speedY = 0;
        myDoseurLevel.speedY = 0;
        doseurLevel2.speedY = 0;
        doseurLevel3.speedY = 0;
        doseurLevel4.speedY = 0;
      }
      function reset() {
        myGamePiece.height = 0;
        myDoseurLevel.height = 0;
        doseurLevel2.height = 0;
        doseurLevel3.height = 0;
        doseurLevel4.height = 0;
      }
    </script>

    <div class="btn-group" >
      <button onclick="reset()" >Nouveau dosage</button>
     
      <button
        onmousedown="moveup()"
        onmouseup="stopMove()"
        ontouchstart="moveup()"
        
      >
        +++</button
      >

      <button
        onmousedown="movedown()"
        onmouseup="stopMove()"
        ontouchstart="movedown()"
        
      >
        ---</button
      >
      <button >
        Dilution</button>
         <input
        type="number"
        id="contenance"
        value="10"
        min="1"
        max="10"
              
             >
     
    </div>
<!--       <div>
        <ul>
        <li style="float:left"><a  class="active" href="./dosage.html">Dosage</a></li>
        <li><a href="./index.html">Monobrosse</a></li>
        <li><a href="./movieCube.html">Videos</a></li>  
        <li><a href="./tracage.html">Traçage</a></li>   
        </ul>
    </div> -->
   
  </body>
</html>
